var anotherExhibition = {"_id":"606a8cb43bb59495855c02d8fdc00e30","_rev":"2-1f420881a834232227b4f3520f9bb04c","date":1458164980053,"title":"Test Essay","artist":"owise1","description":"Lorem ipsum dolor sit amet turducken shoulder hamburger brisket chuck ball tip turkey pork short ribs pig bresaola. Rump brisket tail, meatball chuck ham leberkas frankfurter sausage corned beef pork flank swine meatloaf andouille. Fatback capicola tongue sirloin, pork jerky pig chuck cow bresaola. Filet mignon turducken pig ribeye, chuck pork chop frankfurter leberkas t-bone capicola tri-tip jowl. Venison andouille biltong flank hamburger beef ribs chicken corned beef cow pork belly tenderloin filet mignon shank pork boudin.","thumbnail":"http:\/\/i.giphy.com\/m4UPmDFCkqX6M.gif","works":[{"image":"http:\/\/i.giphy.com\/u2cUV1E1JUkOA.gif","title":"","link":""},{"image":"http:\/\/i.giphy.com\/oLzT6CJRZYPrq.gif","title":"","link":""}],"type":"exhibition", "url" : "http://sharemiodotcom.ly"}

var store = {
   exhibitions : [
        {
          "title" : "Second Test Addendum",
          "artist" : "Steve Lambert",
          "addendum" : true,
          "description" : "Another test essay",
          "link" : "http://addendum.kadist.org",
          "thumbnail" : "http://41.media.tumblr.com/6f11e00a528e554df54836ac55cedbb1/tumblr_o2fy50sXY51r3pm3to3_1280.jpg",
          "date" : 1456249297717,
          "works" : [
            {
            "image" : "http://40.media.tumblr.com/d0a89770ba30c5c42961a1c77f2a5dd8/tumblr_o2fy50sXY51r3pm3to1_1280.jpg"
            },
            {
            "image" : "http://41.media.tumblr.com/6f11e00a528e554df54836ac55cedbb1/tumblr_o2fy50sXY51r3pm3to3_1280.jpg"
            },
            {
            "image" : "http://40.media.tumblr.com/a2591bfd15596aa312f1be2d8c219b4d/tumblr_o2fy50sXY51r3pm3to9_1280.jpg"
            },
            {
            "image" : "http://36.media.tumblr.com/75cee862180d63ea49fd36f75df3a208/tumblr_o2fy50sXY51r3pm3to2_1280.jpg"
            },
            {
            "image" : "http://40.media.tumblr.com/e7aa59c085e0934eded418ccfc525f28/tumblr_o2fy50sXY51r3pm3to5_1280.jpg"
            },
            {
            "image" : "http://40.media.tumblr.com/32de34b423b40ec9b5dc5dc90882718b/tumblr_o2fy50sXY51r3pm3to6_1280.jpg"
            },
            {
            "image" : "http://41.media.tumblr.com/32a2b7ae8f1cc43fcf6d9385ec37d445/tumblr_o2fy50sXY51r3pm3to7_1280.jpg"
            },
            {
            "image" : "http://41.media.tumblr.com/a26b27ada8c6989a3db00080c3a2cf05/tumblr_o2fy50sXY51r3pm3to8_1280.jpg"
            },
            {
            "image" : "http://40.media.tumblr.com/4a0898eea06bf2494742c61b8f39d1f2/tumblr_o2fy50sXY51r3pm3to4_1280.jpg"
            },
            {
            "image" : "http://40.media.tumblr.com/f674a559153916b92bc503951ad10f53/tumblr_o2fy50sXY51r3pm3to10_1280.jpg"
            }
          ]
        },
        {
          "title" : "How long can we tolerate this?",
          "artist" : "Leah Modigliani",
          "addendum" : true,
          "description" : "10 images from artist Leah Modigliani's How long can we tolerate this? An incomplete record from 1933-1999 (2016), an installation comprised of press photographs of evictions taken during the years of the Glass-Steagall Act. The installation is also a timeline, a historical archive and a representation of working and middle-class material displacement.\n\nIn the context of an increasingly divisive 2016 federal election, this work speaks to the role of the press in shaping political consensus about what constitutes a shared ethical responsibility towards others.\n\nThe Glass-Steagall act was signed into law shortly after Franklin D. Roosevelt took office in 1933. To accompany the installation, Modigliani appropriated and revised his inaugural address, updating it to speak to the present:  Only a Foolish Opportunist Can Deny the Dark Realities of the Moment: A Presidential Address (2016).\n\nThe relevance of many of FDR’s words eighty-three years later, in conjunction with the past and present evictions of working class people remind us that while democracy is a powerful aspiration, it’s also a broken promise, and a work in progress.",
          "link" : "http://addendum.kadist.org",
          "thumbnail" : "http://40.media.tumblr.com/d0a89770ba30c5c42961a1c77f2a5dd8/tumblr_o2fy50sXY51r3pm3to1_1280.jpg",
          "date" : 1456249277717,
          "works" : [
            {
            "image" : "http://40.media.tumblr.com/d0a89770ba30c5c42961a1c77f2a5dd8/tumblr_o2fy50sXY51r3pm3to1_1280.jpg"
            },
            {
            "image" : "http://41.media.tumblr.com/6f11e00a528e554df54836ac55cedbb1/tumblr_o2fy50sXY51r3pm3to3_1280.jpg"
            },
            {
            "image" : "http://40.media.tumblr.com/a2591bfd15596aa312f1be2d8c219b4d/tumblr_o2fy50sXY51r3pm3to9_1280.jpg"
            },
            {
            "image" : "http://36.media.tumblr.com/75cee862180d63ea49fd36f75df3a208/tumblr_o2fy50sXY51r3pm3to2_1280.jpg"
            },
            {
            "image" : "http://40.media.tumblr.com/e7aa59c085e0934eded418ccfc525f28/tumblr_o2fy50sXY51r3pm3to5_1280.jpg"
            },
            {
            "image" : "http://40.media.tumblr.com/32de34b423b40ec9b5dc5dc90882718b/tumblr_o2fy50sXY51r3pm3to6_1280.jpg"
            },
            {
            "image" : "http://41.media.tumblr.com/32a2b7ae8f1cc43fcf6d9385ec37d445/tumblr_o2fy50sXY51r3pm3to7_1280.jpg"
            },
            {
            "image" : "http://41.media.tumblr.com/a26b27ada8c6989a3db00080c3a2cf05/tumblr_o2fy50sXY51r3pm3to8_1280.jpg"
            },
            {
            "image" : "http://40.media.tumblr.com/4a0898eea06bf2494742c61b8f39d1f2/tumblr_o2fy50sXY51r3pm3to4_1280.jpg"
            },
            {
            "image" : "http://40.media.tumblr.com/f674a559153916b92bc503951ad10f53/tumblr_o2fy50sXY51r3pm3to10_1280.jpg"
            }
          ]
        }
      ],
  currentExhibition :  "How long can we tolerate this?",
  blockedSites : []
}


var subscriptions = {}
function send (key, val) {
  if (subscriptions[key]) {
    subscriptions[key].forEach(function (cb) {
      cb(val)
    })
  }
}

module.exports = {
  port : {
    on : function (key, cb) {
      subscriptions[key] = subscriptions[key] || []
      subscriptions[key].push(cb)
    },
    emit : function (key, val) {
      switch(key) {
        case 'exhibitions':
          send('exhibitions', store)
          break
        case 'fetchExhibition' :
          if (!/http/.test(val)) {
            send('exhibitionError', true)
          } else {
            store.exhibitions.push(anotherExhibition)
            store.currentExhibition = anotherExhibition.title
            send('exhibitions', store)
            send('exhibitionError', false)
          }
          break
      }
    }
  }
}

